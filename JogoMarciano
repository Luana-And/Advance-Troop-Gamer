let arvoreMarciano;
let tentativas;
let limiteTentativas = 10;
let tentativasRestantes;
let mensagem;
let input = "";
let melhorTentativa = Number.MAX_VALUE;
let jogoAtivo = false;
let telaInicio = true;
let telaResultado = false;
let introducaoTexto = [
    "Você é um explorador espacial em uma missão para encontrar o Marciano.",
    "Ele se escondeu em uma das 100 árvores espalhadas pelo planeta.",
    "Você tem 10 tentativas para encontrar o Marciano.",
    "A cada erro, você receberá uma dica sobre onde ele está.",
    "Boa sorte, explorador! O futuro da missão está em suas mãos!"
];
let indiceIntroducao = 0;

function setup() {
    createCanvas(600, 500);
    textAlign(CENTER, CENTER);
    textSize(20);
    iniciarJogo();
}

function draw() {
    background(153, 50, 204);
    fill(0);

    if (telaInicio) {
        // Exibindo a introdução do jogo
        text(introducaoTexto[indiceIntroducao], width / 2, 200);
        if (frameCount % 300 == 0 && indiceIntroducao < introducaoTexto.length - 1) {
            indiceIntroducao++; // A cada segundo, mostra a próxima parte da história
        }
        if (indiceIntroducao === introducaoTexto.length - 1) {
            text("Pressione ENTER para começar", width / 2, 300);
        }
    } else if (telaResultado) {
        text("Fim de Jogo!", width / 2, 150);
        text(mensagem, width / 2, 200);
        text("Melhor tentativa: " + (melhorTentativa === Number.MAX_VALUE ? "-" : melhorTentativa), width / 2, 250);
        text("Pressione 'R' para jogar novamente", width / 2, 300);
    } else {
        text("Digite um número entre 1 e 100", width / 2, 120);
        text("Pressione Enter após digitar", width / 2, 150);
        text("Número digitado: " + input, width / 2, 250);
        text("Tentativas restantes: " + tentativasRestantes, width / 2, 280);
        text(mensagem, width / 2, 400);
    }
}

function keyPressed() {
    if (telaInicio && keyCode === ENTER) {
        telaInicio = false;
        iniciarJogo();
        return;
    }

    if (telaResultado && (key === 'r' || key === 'R')) {
        iniciarJogo();
        return;
    }

    if (keyCode === ENTER) {
        if (input.length > 0 && jogoAtivo) {
            let tentativa = int(input.trim());
            tentativas++;
            tentativasRestantes--;

            if (tentativa === arvoreMarciano) {
                mensagem = "Parabéns! Você encontrou o Marciano!\nTotal de tentativas: " + tentativas;
                jogoAtivo = false;
                if (tentativas < melhorTentativa) {
                    melhorTentativa = tentativas;
                }
                telaResultado = true;
            } else if (tentativa < arvoreMarciano) {
                mensagem = "O Marciano está em uma árvore de número maior.";
            } else {
                mensagem = "O Marciano está em uma árvore de número menor.";
            }

            if (tentativasRestantes <= 0 && jogoAtivo) {
                mensagem = "Você atingiu o limite de tentativas! O Marciano estava na árvore " + arvoreMarciano;
                jogoAtivo = false;
                telaResultado = true;
            }
            input = "";
        }
    } else if (key >= '0' && key <= '9' && jogoAtivo) {
        input += key;
    } else if (keyCode === BACKSPACE && input.length > 0 && jogoAtivo) {
        input = input.substring(0, input.length - 1);
    }
}

function iniciarJogo() {
    arvoreMarciano = int(random(1, 101));
    tentativas = 0;
    tentativasRestantes = limiteTentativas;
    mensagem = "Adivinhe a árvore do Marciano! Você tem " + limiteTentativas + " tentativas.";
    input = "";
    jogoAtivo = true;
    telaResultado = false;
}
